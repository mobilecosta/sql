-- Edt
SELECT * FROM AFC010 
 WHERE D_E_L_E_T_ = ' ' AND AFC_XPROD = 'CELNAC003013A';

-- Tarefas
SELECT AF9_EDTPAI, * FROM AF9010 
 WHERE D_E_L_E_T_ = ' ' AND AF9_PROJET = 'PMS003013A' 
 ORDER BY AF9_PROJET, AF9_TAREFA, AF9_NIVEL;

-- Recursos
SELECT * FROM AFA010 
 WHERE D_E_L_E_T_ = ' ' AND AFA_PROJET = 'PMS003013A'
 ORDER BY AFA_PROJET, AFA_TAREFA, AFA_ITEM;
 
-- Quantidade de horas do projeto
SELECT AFA.AFA_PROJET, AFA.AFA_TAREFA, AFC.AFC_XPROD, SUM(AFA.AFA_QUANT) AS AFA_QUANT 
  FROM AFA010 AFA 
  JOIN AF9010 AF9 ON AF9.D_E_L_E_T_ = ' ' AND AF9.AF9_FILIAL = AFA.AFA_FILIAL AND AF9.AF9_PROJET = AFA.AFA_PROJET 
   AND AF9.AF9_TAREFA = AFA.AFA_TAREFA AND AF9.AF9_XTPTAR = '4'
  JOIN AFC010 AFC ON AFC.D_E_L_E_T_ = ' ' AND AFC.AFC_FILIAL = AFA.AFA_FILIAL AND AFC.AFC_PROJET = AFA.AFA_PROJET 
   AND AFC.AFC_EDT = AF9.AF9_EDTPAI 
 WHERE AFA.D_E_L_E_T_ = ' ' AND AFA.AFA_PROJET = 'PMS003013A' 
 GROUP BY AFA.AFA_PROJET, AFA.AFA_TAREFA, AFC.AFC_XPROD
 ORDER BY AFA.AFA_PROJET, AFA.AFA_TAREFA, AFC.AFC_XPROD;
 
-- Custo - Total
SELECT SUM(D2.D2_CUSTO1) AS D2_CUSTO1 
  FROM SD2010 D2 
  JOIN SF4010 F4 ON F4.D_E_L_E_T_ = ' ' AND F4_FILIAL = '01' AND F4.F4_CODIGO = D2.D2_TES AND F4.F4_XTESPAE = '1' 
  JOIN SB1010 SB1 ON SB1.D_E_L_E_T_ = ' ' AND B1_FILIAL = '01' AND SB1.B1_COD = D2.D2_COD AND SB1.B1_TIPO = 'PA'  
 WHERE D2.D2_FILIAL = '01' AND D2.D2_EMISSAO >= '20130901' AND D2_EMISSAO <='20130930' AND D2.D2_CUSTO1 > 0 
   AND D2.D2_TIPO <> 'D' AND D2.D_E_L_E_T_=' ';

-- Custo - Produtos
SELECT SUM(CASE WHEN SB1.B1_TIPO = 'PA' THEN SD2.D2_CUSTO1 / 1814004.42 ELSE 0.00 END) AS D2_PER_CUS,
       SD2.D2_COD,SB1.B1_TIPO,MIN(SD2.D2_UM) AS D2_UM,SUM(SD2.D2_CUSTO1) AS D2_CUSTO1,
       SUM(SD2.D2_QUANT) AS D2_QUANT 
  FROM SD2010 SD2 
  JOIN SF4010 F4 ON F4.D_E_L_E_T_ = ' ' AND F4_FILIAL = '01' AND F4.F4_CODIGO = SD2.D2_TES AND F4.F4_XTESPAE = '1' 
  LEFT JOIN SB1010 SB1 ON B1_FILIAL = '01' AND SB1.B1_COD = SD2.D2_COD AND SB1.D_E_L_E_T_ =' '  
 WHERE SD2.D_E_L_E_T_ = ' ' AND SD2.D2_FILIAL = '01' AND SD2.D2_EMISSAO >= '20130901' AND SD2.D2_EMISSAO <='20130930' 
   AND SD2.D2_CUSTO1 > 0 AND SD2.D2_TIPO <> 'D' 
 GROUP BY SD2.D2_COD, SB1.B1_TIPO  
 ORDER BY SB1.B1_TIPO, SD2.D2_COD;
 
-- Horas - Total
SELECT SUM(AFA.AFA_QUANT) AS AFA_QUANT 
  FROM SD2010 D2 
  JOIN SF4010 F4 ON F4.D_E_L_E_T_ = ' ' AND F4_FILIAL = '01' AND F4.F4_CODIGO = D2.D2_TES AND F4.F4_XTESPAE = '1' 
  JOIN SB1010 SB1 ON SB1.D_E_L_E_T_ = ' ' AND B1_FILIAL = '01' AND SB1.B1_COD = D2.D2_COD AND SB1.B1_TIPO = 'PA'  
  JOIN AFC010 AFC ON AFC.D_E_L_E_T_ = ' ' AND AFC.AFC_FILIAL = D2.D2_FILIAL AND AFC.AFC_XPROD = D2.D2_COD
  JOIN AF9010 AF9 ON AF9.D_E_L_E_T_ = ' ' AND AF9.AF9_FILIAL = AFC.AFC_FILIAL AND AF9.AF9_PROJET = AFC.AFC_PROJET 
   AND AF9.AF9_EDTPAI = AFC.AFC_EDT  AND AF9.AF9_XTPTAR = '4'
  JOIN AFA010 AFA ON AFA.D_E_L_E_T_ = ' ' AND AFA.AFA_FILIAL = D2.D2_FILIAL AND AF9.AF9_PROJET = AFA.AFA_PROJET 
   AND AF9.AF9_TAREFA = AFA.AFA_TAREFA
 WHERE D2.D2_FILIAL = '01' AND D2.D2_EMISSAO >= '20130901' AND D2_EMISSAO <='20130930' AND D2.D2_CUSTO1 > 0 
   AND D2.D2_TIPO <> 'D' AND D2.D_E_L_E_T_=' ';
   
SELECT D2.D2_COD, SUM(AFA.AFA_QUANT) AS AFA_QUANT 
  FROM SD2010 D2 
  JOIN SF4010 F4 ON F4.D_E_L_E_T_ = ' ' AND F4_FILIAL = '01' AND F4.F4_CODIGO = D2.D2_TES AND F4.F4_XTESPAE = '1' 
  JOIN SB1010 SB1 ON SB1.D_E_L_E_T_ = ' ' AND B1_FILIAL = '01' AND SB1.B1_COD = D2.D2_COD AND SB1.B1_TIPO = 'PA'  
  JOIN AFC010 AFC ON AFC.D_E_L_E_T_ = ' ' AND AFC.AFC_FILIAL = D2.D2_FILIAL AND AFC.AFC_XPROD = D2.D2_COD
  JOIN AF9010 AF9 ON AF9.D_E_L_E_T_ = ' ' AND AF9.AF9_FILIAL = AFC.AFC_FILIAL AND AF9.AF9_PROJET = AFC.AFC_PROJET 
   AND AF9.AF9_EDTPAI = AFC.AFC_EDT  AND AF9.AF9_XTPTAR = '4'
  JOIN AFA010 AFA ON AFA.D_E_L_E_T_ = ' ' AND AFA.AFA_FILIAL = D2.D2_FILIAL AND AF9.AF9_PROJET = AFA.AFA_PROJET 
   AND AF9.AF9_TAREFA = AFA.AFA_TAREFA
 WHERE D2.D2_FILIAL = '01' AND D2.D2_EMISSAO >= '20130901' AND D2_EMISSAO <='20130930' AND D2.D2_CUSTO1 > 0 
   AND D2.D2_TIPO <> 'D' AND D2.D_E_L_E_T_=' '
 GROUP BY D2.D2_COD;
 
-- Horas - Produtos
SELECT SUM(CASE WHEN SB1.B1_TIPO = 'PA' THEN SD2.D2_CUSTO1 / 1814004.42 ELSE 0.00 END) AS D2_PER_CUS,
       SUM(CASE WHEN SB1.B1_TIPO = 'PA' THEN HOR.AFA_QUANT / 2134 ELSE 0.00 END) AS D2_PER_HOR,
       SD2.D2_COD,SB1.B1_TIPO,MIN(SD2.D2_UM) AS D2_UM, SUM(SD2.D2_CUSTO1) AS D2_CUSTO1,
       SUM(SD2.D2_QUANT) AS D2_QUANT, MIN(HOR.AFA_QUANT) AS AFA_QUANT
  FROM SD2010 SD2 
  JOIN SF4010 F4 ON F4.D_E_L_E_T_ = ' ' AND F4_FILIAL = '01' AND F4.F4_CODIGO = SD2.D2_TES AND F4.F4_XTESPAE = '1' 
  LEFT JOIN SB1010 SB1 ON B1_FILIAL = '01' AND SB1.B1_COD = SD2.D2_COD AND SB1.D_E_L_E_T_ =' '  
  LEFT JOIN (
SELECT SD2.D2_COD, SUM(AFA.AFA_QUANT) AS AFA_QUANT 
  FROM SD2010 SD2 
  JOIN SF4010 F4 ON F4.D_E_L_E_T_ = ' ' AND F4_FILIAL = '01' AND F4.F4_CODIGO = SD2.D2_TES AND F4.F4_XTESPAE = '1' 
  JOIN AFC010 AFC ON AFC.D_E_L_E_T_ = ' ' AND AFC.AFC_FILIAL = SD2.D2_FILIAL AND AFC.AFC_XPROD = SD2.D2_COD
  JOIN AF9010 AF9 ON AF9.D_E_L_E_T_ = ' ' AND AF9.AF9_FILIAL = AFC.AFC_FILIAL AND AF9.AF9_PROJET = AFC.AFC_PROJET 
   AND AF9.AF9_EDTPAI = AFC.AFC_EDT  AND AF9.AF9_XTPTAR = '4'
  JOIN AFA010 AFA ON AFA.D_E_L_E_T_ = ' ' AND AFA.AFA_FILIAL = SD2.D2_FILIAL AND AF9.AF9_PROJET = AFA.AFA_PROJET 
   AND AF9.AF9_TAREFA = AFA.AFA_TAREFA
 WHERE SD2.D_E_L_E_T_ = ' ' AND SD2.D2_FILIAL = '01' AND SD2.D2_EMISSAO >= '20130901' AND SD2.D2_EMISSAO <='20130930' 
   AND SD2.D2_CUSTO1 > 0 AND SD2.D2_TIPO <> 'D' 
 GROUP BY SD2.D2_COD ) HOR ON HOR.D2_COD = SD2.D2_COD  
 WHERE SD2.D_E_L_E_T_ = ' ' AND SD2.D2_FILIAL = '01' AND SD2.D2_EMISSAO >= '20130901' AND SD2.D2_EMISSAO <='20130930' 
   AND SD2.D2_CUSTO1 > 0 AND SD2.D2_TIPO <> 'D' 
 GROUP BY SD2.D2_COD, SB1.B1_TIPO  
 ORDER BY SB1.B1_TIPO, SD2.D2_COD;