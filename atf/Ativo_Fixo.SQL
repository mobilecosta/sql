-- Calculo do PIS/COFINS dos ativos
SELECT SUM(N1_VLAQUIS) AS VALOR_ATIVO, SUM(SOMA) AS VLR_DEPR
  FROM
(  
SELECT N4_DATA,N4_CBASE,N4_ITEM,N1_DESCRIC,N1_CALCPIS,SUM(SN4.N4_VLROC1) SOMA,
       N3_AQUISIC,N3_DINDEPR,N1_MESCPIS,MIN(N1_VLAQUIS) AS N1_VLAQUIS
  FROM SN1010 SN1, SN3010 SN3, SN4010 SN4
 WHERE N1_FILIAL = '01' AND N1_CALCPIS IN ('1','S','3') AND SN1.D_E_L_E_T_=' ' AND N3_FILIAL='01' AND N3_CBASE = N1_CBASE
   AND N3_ITEM  = N1_ITEM AND SN3.D_E_L_E_T_=' ' AND N4_FILIAL='01' AND N4_CBASE = N1_CBASE AND N4_ITEM  = N1_ITEM
   AND N4_TIPO  = N3_TIPO AND N4_SEQ = N3_SEQ AND N4_DATA>='20111001' AND N4_DATA<='20111031' AND N4_OCORR IN ('06','10') 
   AND N4_TIPOCNT ='3' AND SN4.D_E_L_E_T_=' '
 GROUP BY N4_DATA,N4_CBASE,N4_ITEM,N1_DESCRIC,N1_CALCPIS,N3_AQUISIC,N3_DINDEPR,N1_MESCPIS
) AS SN1; 

-- Ativos
select N1_CALCPIS, * from SN1010 
 WHERE N1_FILIAL = '01' AND N1_CALCPIS IN ('1','S','3');
 
select * from SN4010  
 where N4_DATA>='20111001' AND N4_DATA<='20111031';

-- Valor das moedas
select sum(M2_MOEDA2) as M2_MOEDA2, sum(M2_MOEDA3) as M2_MOEDA3 
  from SM2010
 where M2_DATA >= '20110801' and M2_DATA <= '20110831'  

update SM2010 set M2_MOEDA3 = 0.8287 where M2_DATA >= '20110901' 
   and M2_DATA <= '20110930'

-- Somatória do calculo da depreciação
select N4_OCORR, SUM(N4_VLROC1) from SN4010 WHERE D_E_L_E_T_ = ' '
group by N4_OCORR;
   
-- Somatória do calculo da depreciação
select N4_OCORR, SUM(N4_VLROC1) from SN4010 WHERE N4_DATA = '20110831' and N4_TIPOCNT = '3'
group by N4_OCORR;

select sum(N3_VRDMES1) from SN3010;

-- Primeiro ativo
select * from SN4010 where N4_CBASE = '0000000001';

select * from SN4010 where N4_CBASE = '0000000037';

select TOP 1 * from SN4010 

select COUNT(*) from SN1010 WHERE D_E_L_E_T_ = ' ';

select SUM(F9_VALICMS) from SF9010 WHERE D_E_L_E_T_ = ' ';

select F9_VALICMS,* from SF9010;

select * from SN1010 order by N1_CBASE;

-- Seleção dos bens de uma conta
SELECT YEAR(SN1.N1_AQUISIC) AS ANO, SUM(SN3.N3_VORIG1) AS N3_VORIG1
  FROM SN3010 SN3
  JOIN SN1010 SN1 ON SN1.N1_CBASE = N3_CBASE AND SN1.N1_ITEM = N3_ITEM
  WHERE SN3.N3_CCONTAB = '132108'
  GROUP BY YEAR(SN1.N1_AQUISIC);

-- Saldo Contábil
SELECT CASE WHEN LEFT(CT2_DEBITO, 5) BETWEEN '13210' AND '13211' THEN CT2_DEBITO ELSE CT2_CREDIT END AS CT2_CONTA, 
       SUM(CASE WHEN LEFT(CT2_DEBITO, 5) BETWEEN '13210' AND '13211' 
                 AND YEAR(CT2_DATA) <= 2010 THEN CT2_VALOR ELSE 0 END - 
           CASE WHEN LEFT(CT2_CREDIT, 5) BETWEEN '13210' AND '13211' 
                 AND YEAR(CT2_DATA) <= 2010 THEN CT2_VALOR ELSE 0 END) AS CT2_ANTERIOR,
       SUM(CASE WHEN LEFT(CT2_DEBITO, 5) BETWEEN '13210' AND '13211' 
                 AND YEAR(CT2_DATA) = 2011 THEN CT2_VALOR ELSE 0 END -
           CASE WHEN LEFT(CT2_CREDIT, 5) BETWEEN '13210' AND '13211' 
                 AND YEAR(CT2_DATA) = 2011 THEN CT2_VALOR ELSE 0 END) AS CT2_SALDO
  FROM CT2010 
 WHERE D_E_L_E_T_ = ' ' AND (LEFT(CT2_DEBITO, 5) BETWEEN '13210' AND '13211' OR LEFT(CT2_CREDIT, 5) BETWEEN '13210' AND '13211') 
 GROUP BY CASE WHEN LEFT(CT2_DEBITO, 5) BETWEEN '13210' AND '13211' THEN CT2_DEBITO ELSE CT2_CREDIT END
 ORDER BY CASE WHEN LEFT(CT2_DEBITO, 5) BETWEEN '13210' AND '13211' THEN CT2_DEBITO ELSE CT2_CREDIT END;
  
SELECT * FROM CT2010 WHERE CT2_DEBITO = '132102' OR CT2_CREDIT = '132102';
  
SELECT YEAR(CT2.CT2_DATA) AS ANO, SUM(CT2.N3_VORIG1) AS N3_VORIG1
  FROM CT2010 CT2
  WHERE  CT2 = '132108'
  GROUP BY YEAR(SN1.N1_AQUISIC);
  
  
-- Valor Original por Conta
select N3_CCONTAB, SUM(N3_VORIG1) as N3_VORIG1
  from SN3010
 where D_E_L_E_T_ = ' '
 GROUP BY N3_CCONTAB
 ORDER BY N3_CCONTAB;

-- Valor Original por Conta
select N3_CCDEPR, SUM(N3_VRDACM1) as N3_VRDACM1
  from SN3010
 where D_E_L_E_T_ = ' '
 GROUP BY N3_CCDEPR
 ORDER BY N3_CCDEPR;

-- Valor Original por Conta e Centro de Custo
select N3_CCONTAB, N3_CCUSTO, SUM(N3_VORIG1) as N3_VORIG1
  from SN3010
 where D_E_L_E_T_ = ' '
 GROUP BY N3_CCONTAB, N3_CCUSTO
 ORDER BY N3_CCONTAB, N3_CCUSTO;

-- Bens com aquisição em 09/2011 e/ou bens baixados
select * from SN1010 WHERE N1_AQUISIC > '20110901' or N1_BAIXA <> '';
select * from SN3010 WHERE N3_AQUISIC > '20110901' or N3_BAIXA = '1';

-- Gera copia da tabela
select * into SN10911 from SN1010 WHERE N1_AQUISIC > '20110901' or N1_BAIXA <> '';
select * into SN30911 from SN3010 WHERE N3_AQUISIC > '20110901' or N3_BAIXA = '1';

-- Acumulado 
select N3_CCDEPR, SUM(N3_VRDACM1) as N3_VRDACM1
  from SN3010
 where D_E_L_E_T_ = ' '
 GROUP BY N3_CCDEPR
 ORDER BY N3_CCDEPR;

SELECT N4_DATA, N4_OCORR, N4_CONTA, SUM(N4_VLROC1) AS N4_VLROC1 FROM SN4010 
 GROUP BY N4_DATA, N4_OCORR, N4_CONTA
 ORDER BY N4_DATA, N4_OCORR, N4_CONTA;
 
SELECT N4_DATA, N4_OCORR, SUM(N4_VLROC1) AS N4_VLROC1 FROM SN4010 
 GROUP BY N4_DATA, N4_OCORR
 ORDER BY N4_DATA, N4_OCORR;
 
SELECT * FROM SN4010 WHERE N4_DATA = '20110930' AND N4_CONTA = '132201' ORDER BY N4_CBASE;

SELECT SUM(N4_VLROC1) FROM SN4010 WHERE N4_DATA = '20110930' AND N4_CONTA = '132201';

SELECT REPLACE(SN1.N1_DESCRIC, '"', '') AS N1_DESCRIC, SN4.N4_VLROC1
  FROM SN4010 SN4 
  JOIN SN1010 SN1 ON SN1.N1_CBASE = SN4.N4_CBASE AND SN1.N1_ITEM = SN4.N4_ITEM
 WHERE SN4.N4_DATA = '20110930' AND SN4.N4_CONTA = '132201'
 ORDER BY SN4.N4_CBASE, SN4.N4_ITEM;

-- Valor do Ativo
select N3_CCONTAB, SUM(N3_VORIG1) as N3_VORIG1
  from SN3010
 where D_E_L_E_T_ = ' '
 GROUP BY N3_CCONTAB
 ORDER BY N3_CCONTAB;

-- Depreciação
select N3_CCDEPR, SUM(N3_VRDACM1) as N3_VRDACM1
  from SN3010
 where D_E_L_E_T_ = ' '
 GROUP BY N3_CCDEPR
 ORDER BY N3_CCDEPR;
 
-- Conta de Despesa x CC
select N3_CCUSTO, N3_CDEPREC, SUM(N3_VORIG1) as N3_VORIG1
  from SN3010
 where D_E_L_E_T_ = ' '
 GROUP BY N3_CCUSTO, N3_CDEPREC
 ORDER BY N3_CCUSTO, N3_CDEPREC;
 
-- Base de Calculo do PIS/Cofins
SELECT SUM(VLR_PIS) AS VLR_PIS, SUM(VLR_COFINS) AS VLR_COFINS
  FROM (
SELECT LEFT(SN1.N1_AQUISIC, 6) AS COMPETE, SUM(SN1.N1_VLAQUIS) AS BASE, 
       SUM(SN1.N1_VLAQUIS * 0.0165) AS VLR_PIS, SUM(SN1.N1_VLAQUIS * 0.0760) AS VLR_COFINS
  FROM SN1010 SN1
 WHERE SN1.N1_CALCPIS = '1'
 GROUP BY LEFT(SN1.N1_AQUISIC, 6)
 -- ORDER BY LEFT(SN1.N1_AQUISIC, 6)
 ) AS BASE;
 
SELECT SUM(SN1.N1_VLAQUIS) AS BASE, 
       SUM(SN1.N1_VLAQUIS * 0.0165) AS VLR_PIS, SUM(SN1.N1_VLAQUIS * 0.760) AS VLR_COFINS
  FROM SN1010 SN1
 WHERE SN1.N1_CALCPIS = '1';
 
SELECT SN1.N1_CBASE, SN1.N1_VLAQUIS, SN1.N1_VLAQUIS * 0.0165 AS VLR_PIS, SN1.N1_VLAQUIS * 0.0760 AS VLR_COFINS
  FROM SN1010 SN1
 WHERE SN1.N1_CALCPIS = '1'
 ORDER BY SN1.N1_CBASE;
 
-- Itens de uma nota
select D1_DOC, D1_SERIE, D1_ITEM, D1_QUANT, D1_VUNIT, D1_COD, D1_FORNECE, D1_LOJA, SB1.B1_DESC, SD1010.* 
  from SD1010 
  JOIN SB1010 SB1 ON SB1.B1_COD = SD1010.D1_COD
 where D1_DOC IN ('000020314','000025586')
 order by D1_DOC,D1_ITEM;

select COUNT(*) from SD1010 where D1_DOC = '000020314'; 

select * from SN4010 where N4_DATA = '20111031';