-- Fornecedor x Pais BACEN
select SA2.A2_COD, SA2.A2_CODPAIS, CCH.CCH_CODIGO, CCH.CCH_PAIS
  from SA2010 SA2
  JOIN CCH010 CCH ON CCH.CCH_CODIGO = SA2.A2_CODPAIS AND CCH.D_E_L_E_T_ = ' '
 where SA2.A2_CODPAIS <> ' ' AND SA2.A2_CODPAIS <> '01058' AND SA2.D_E_L_E_T_ = ' '
 ORDER BY SA2.A2_COD;

-- Fornecedor x Pais EIC
select SA2.A2_COD, SA2.A2_PAIS, SYA.YA_CODGI, SYA.YA_DESCR
  from SA2010 SA2
  JOIN SYA010 SYA ON SYA.YA_CODGI = SA2.A2_PAIS AND SYA.D_E_L_E_T_ = ' '
 where SA2.A2_PAIS <> ' ' AND SA2.D_E_L_E_T_ = ' '
 ORDER BY SA2.A2_COD; 

-- Cadastro de Paises
select * from CCH010;

-- Clientes x Pais BACEN
select SA1.A1_COD, SA1.A1_CODPAIS, CCH.CCH_CODIGO, CCH.CCH_PAIS
  from SA1010 SA1
  JOIN CCH010 CCH ON CCH.CCH_CODIGO = SA1.A1_CODPAIS AND CCH.D_E_L_E_T_ = ' '
 where SA1.A1_CODPAIS <> ' ' AND SA1.A1_CODPAIS <> '01058' AND SA1.D_E_L_E_T_ = ' '
 ORDER BY SA1.A1_COD;

-- Clientes x Pais EIC
select SA1.A1_COD, SA1.A1_PAIS, SYA.YA_CODGI, SYA.YA_DESCR
  from SA1010 SA1
  JOIN SYA010 SYA ON SYA.YA_CODGI = SA1.A1_PAIS AND SYA.D_E_L_E_T_ = ' '
 where SA1.A1_PAIS <> ' ' AND SA1.A1_CODPAIS <> '01058' AND SA1.D_E_L_E_T_ = ' '
 ORDER BY SA1.A1_COD; 
 
-- Diferença entre dois campos de pais existentes no siga 
select CASE WHEN COALESCE(CCH_PAIS, '') = COALESCE(SYA.YA_DESCR, '') AND CCH.CCH_XPAISE = '' 
            THEN 'Falta Pais Ernest' else 'Divergencia Cadastro' end as status,
       SA2.A2_PAIS, CCH.CCH_PAIS, SA2.A2_CODPAIS, SYA.YA_DESCR, SA2.* 
  from SA2010 SA2
  LEFT JOIN CCH010 CCH ON CCH.CCH_CODIGO = SA2.A2_CODPAIS AND CCH.D_E_L_E_T_ = ' '
  LEFT JOIN SYA010 SYA ON SYA.YA_CODGI = SA2.A2_PAIS AND SYA.D_E_L_E_T_ = ' '
 where (SA2.A2_PAIS <> '' or (SA2.A2_CODPAIS <> '01058' and SA2.A2_CODPAIS <> '')) 
   AND (COALESCE(CCH_PAIS, '') <> COALESCE(SYA.YA_DESCR, '') OR CCH.CCH_XPAISE = '')
   AND COALESCE(CCH_PAIS, '') <> COALESCE(SYA.YA_DESCR, '');
   
-- Diferença entre dois campos de pais existentes no siga 
select SA1.A1_PAIS, CCH.CCH_PAIS, SA1.A1_CODPAIS, SYA.YA_DESCR, SA1.* 
  from SA1010 SA1
  LEFT JOIN CCH010 CCH ON CCH.CCH_CODIGO = SA1.A1_CODPAIS AND CCH.D_E_L_E_T_ = ' '
  LEFT JOIN SYA010 SYA ON SYA.YA_CODGI = SA1.A1_PAIS AND SYA.D_E_L_E_T_ = ' '
 where (SA1.A1_PAIS <> '' or (SA1.A1_CODPAIS <> '01058' and SA1.A1_CODPAIS <> ''))
   AND COALESCE(CCH_PAIS, '') <> COALESCE(SYA.YA_DESCR, '');

-- Criação de campo e preenchimento de pais para ERNEST
ALTER TABLE CCH010 ADD CCH_XPAISE VARCHAR(3);
UPDATE CCH010 SET CCH_XPAISE = CASE WHEN CCH_CODIGO = '02496' THEN 'USA' ELSE 
                               CASE WHEN CCH_CODIGO = '03867' THEN 'ITA' ELSE 
                               CASE WHEN CCH_CODIGO = '03999' THEN 'JPN' ELSE 
                               CASE WHEN CCH_CODIGO = '01589' THEN 'CHL' ELSE
                               CASE WHEN CCH_CODIGO = '00639' THEN 'ARG' ELSE 
                               CASE WHEN CCH_CODIGO = '04936' THEN 'MEX' ELSE 
                               CASE WHEN CCH_CODIGO = '00230' THEN 'ALE' ELSE
                               CASE WHEN CCH_CODIGO = '08311' THEN 'UK ' ELSE '   ' END END END END END END END END;

-- Exportação Ernerst
SELECT A2.A2_FILIAL,A2.A2_COD,A2.A2_LOJA,A2.A2_NOME,A2.A2_CGC,A2.A2_EST,CCH.CCH_XPAISE AS A2_XPAIS,A2.A2_MSBLQL,CASE WHEN A2.A2_NOME LIKE '%MOTOMAN%' OR A2.A2_NOME LIKE '%YASKAWA%' THEN 'S' ELSE 'N' END AS A2_XVINC
  FROM SA2010 A2 
  LEFT JOIN CCH010 CCH ON CCH.CCH_CODIGO = A2.A2_CODPAIS AND CCH.D_E_L_E_T_ = ' ' 
 WHERE A2.A2_FILIAL = '  ' AND A2.A2_COD >= '      ' AND A2.A2_COD <= 'ZZZZZ ' AND D_E_L_E_T_=' ' ;

 -- Custo de Produto Acabado
SELECT D2.D2_COD, SUM(D2.D2_QUANT) AS D2_QUANT, SUM(D2.D2_CUSTO1) AS D2_CUSTO1
  FROM SD2010 D2, SF4010 F4
 WHERE D2_FILIAL  = '01' AND F4_FILIAL = '01' AND D2_TES = F4_CODIGO
   AND D2_EMISSAO >= '20110101' AND D2_EMISSAO <= '20113108' AND D2_CUSTO1 > 0
   AND D2_TIPO <> 'D' AND D2.D_E_L_E_T_='' AND F4.D_E_L_E_T_=''
   AND D2.D2_COD IN ('SDAC.0016.01.PA','ELTF.0017.01.ME')
   AND F4_CODIGO IN ('704','707','711','729','752','754','762','765','769','781','788','789','800','803','801','796','797','764','804')
 GROUP BY D2.D2_COD
 ORDER BY D2.D2_COD;


SELECT D2.D2_COD, D2_TES, SUM(D2.D2_QUANT) AS D2_QUANT, SUM(D2.D2_CUSTO1) AS D2_CUSTO1
  FROM SD2010 D2, SF4010 F4
 WHERE D2_FILIAL  = '01' AND F4_FILIAL = '01' AND D2_TES = F4_CODIGO
   AND D2_EMISSAO >= '20110101' AND D2_EMISSAO <= '20113108' AND D2_CUSTO1 > 0
   AND D2_TIPO <> 'D' AND D2.D_E_L_E_T_='' AND F4.D_E_L_E_T_=''
   AND D2.D2_COD IN ('SDAC.0016.01.PA','ELTF.0017.01.ME')
 GROUP BY D2.D2_COD, D2_TES
 ORDER BY D2.D2_COD, D2_TES;

-- Marca classificação produtos acabados
update SF4010 SET F4_XTESPAE = '2';

update SF4010 SET F4_XTESPAE = '1'
 WHERE F4_CODIGO IN ('704','707','711','729','752','754','762','765','769','781','788','789','800','803','801','796','797','764','804', '706', '776');

-- Marca classificação produtos vendas
update SF4010 SET F4_XTESVDE = '2';

update SF4010 SET F4_XTESVDE = '1'
 WHERE F4_CODIGO IN ('704','706','707','711','729','752','754','762','765','769','781','788','789','800','803');