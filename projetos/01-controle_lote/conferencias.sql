-- Produtos de saldo empenhado x Projetos
SELECT PRJ.AFC_PROJET, PRJ.AFC_XOP, PRJ.AFC_XPROD, SG1.G1_COMP, SG1.G1_QUANT, SB2.B2_QATU
  FROM SG1010 SG1
  JOIN (SELECT AFC.AFC_PROJET, AFC.AFC_XOP, AFC_XPROD
          FROM SB2010 SB2
          JOIN AFA010 AFA ON AFA.D_E_L_E_T_ = ' ' AND AFA.AFA_FILIAL = SB2.B2_FILIAL
           AND AFA.AFA_PRODUT = SB2.B2_COD AND AFA.AFA_XESTRU = 'S'
          JOIN AF9010 AF9 ON AF9.D_E_L_E_T_ = ' ' AND AF9.AF9_FILIAL = AFA.AFA_FILIAL AND AF9.AF9_PROJET = AFA.AFA_PROJET
          JOIN AFC010 AFC ON AFC.D_E_L_E_T_ = ' ' AND AFC.AFC_FILIAL = '01' AND AFC.AFC_PROJET = AFA.AFA_PROJET
           AND AFC.AFC_EDT = AF9.AF9_EDTPAI AND AFC.AFC_NIVEL > '001'
          LEFT JOIN SD3010 SD3 ON SD3.D_E_L_E_T_ = ' ' AND SD3.D3_FILIAL = '01' AND SD3.D3_OP = AFC.AFC_XOP
           AND SD3.D3_COD = AFC.AFC_XPROD
         WHERE SB2.B2_QEMP > 0 AND SD3.R_E_C_N_O_ IS NULL AND AFC.AFC_XOP <> ''
         GROUP BY AFC.AFC_PROJET, AFC.AFC_XOP, AFC_XPROD) PRJ ON PRJ.AFC_XPROD = SG1.G1_COD
  LEFT JOIN SB2010 SB2 ON SB2.D_E_L_E_T_ = ' ' AND SB2.B2_FILIAL = '01' AND SB2.B2_COD = SG1.G1_COMP
   AND SB2.B2_LOCAL = '01'
 WHERE SG1.D_E_L_E_T_ = ' ' AND SG1.G1_FILIAL = '01'
 ORDER BY RIGHT(PRJ.AFC_PROJET, 3), LEFT(PRJ.AFC_PROJET, 7), PRJ.AFC_XPROD, SG1.G1_COMP; 
 
SELECT * FROM SB8010;
SELECT * FROM SBJ010;
SELECT * FROM SD5010;

SELECT B8_SALDO, * FROM SB8010 WHERE B8_PRODUTO = 'CAEL.0002.01.MP';

-- Saldo Atual por Local
SELECT SUM(B2_QATU) AS B2_ATU, SUM(B2_RESERVA) AS B2_RESERVA
  FROM SB2010
 WHERE D_E_L_E_T_ = ' ';

-- Saldo em uma data por Local
SELECT SUM(B9_QINI)
  FROM SB9010
 WHERE D_E_L_E_T_ = ' ' AND B9_DATA = '20120531';

-- Saldo Por Lote x Local - 24241,77
SELECT SUM(B8_QTDORI) AS B8_QTDORI, SUM(B8_SALDO) AS B8_SALDO, SUM(B8_EMPENHO) AS B8_EMPENHO
  FROM SB8010
 WHERE D_E_L_E_T_ = ' ';

select SUM(QUANT) AS QUANT
  from (
select B1_COD, SUM(QUANT) AS QUANT
  from KARDEX
 where DATA between '20120501' and '20120531' and B1_LOCAL = '01'
 group by B1_COD
 having SUM(QUANT) <> 0) TAB
 
SELECT SUM(B9_QINI) FROM SB9010 WHERE D_E_L_E_T_ = ' ' AND B9_FILIAL = '01' AND B9_LOCAL = '01'
   AND B9_DATA = '20120430';
SELECT SUM(B2_QATU) FROM SB2010 WHERE D_E_L_E_T_ = ' '; 

-- Compara Lote x Saldo Fechamento x Atual
SELECT SB2.B2_QATU, SB9.B9_QINI, KDX.QUANT, SB8.* FROM SB8010 SB8
  LEFT JOIN SB2010 SB2 ON SB2.B2_FILIAL = SB8.B8_FILIAL AND SB2.D_E_L_E_T_ = ' ' AND SB2.B2_LOCAL = '01'
   AND SB2.B2_COD = SB8.B8_PRODUTO
  LEFT JOIN SB9010 SB9 ON SB9.B9_FILIAL = SB8.B8_FILIAL AND SB9.D_E_L_E_T_ = ' ' AND SB9.B9_LOCAL = '01'
   AND SB9.B9_COD = SB8.B8_PRODUTO AND SB9.B9_DATA = '20120430'
  left join (select B1_COD, SUM(QUANT) AS QUANT
               from KARDEX
              where DATA between '20120501' and '20120531' and B1_LOCAL = '01'
              group by B1_COD
             having SUM(QUANT) <> 0) KDX on KDX.B1_COD = SB8.B8_PRODUTO
 WHERE SB9.B9_QINI + KDX.QUANT <> SB8.B8_SALDO;


-- Saldo em uma data por lote
SELECT SUM(BJ_QINI)
  FROM SBJ010
 WHERE D_E_L_E_T_ = ' ' AND BJ_DATA = '20120531';

-- Movimentação por Lote
select SUM(D5_QUANT * CASE WHEN D5_ORIGLAN < '500' THEN 1 ELSE -1 END) AS SALDO
  from SD5010
 where D_E_L_E_T_ = ' ';
 
SELECT * FROM SD5010 WHERE D_E_L_E_T_ = ' ' AND D5_FILIAL = '01' AND D5_ESTORNO = 'S';
SELECT * FROM SD3010 WHERE D_E_L_E_T_ = ' ' AND D3_FILIAL = '01' AND D3_ESTORNO = 'S';

SELECT * FROM SB8010 WHERE B8_PRODUTO = 'CAEL.0002.01.MP';
SELECT * FROM SD5010 WHERE D5_PRODUTO = 'CAEL.0002.01.MP';

-- Abertura do estoque
DELETE FROM SB9010 WHERE B9_DATA = '20120531';
DELETE FROM SBJ010 WHERE BJ_DATA = '20120531';

SELECT * FROM SD3010 WHERE D3_OP LIKE '%MSDHIV%';

SELECT * FROM SD5010 WHERE D5_DATA >= '20120521';

SELECT D1_EMISSAO, D1_DTDIGIT, * FROM SD1010 WHERE D1_COD = 'MCDC.0001.01.MC';

SELECT D1_EMISSAO, D1_DTDIGIT, * FROM SD1010 WHERE D1_COD = '158290-4MP';

SELECT * FROM SB8010 WHERE B8_PRODUTO = 'MCDC.0001.01.MC';

SELECT B2_QEMP, B2_SALPEDI, * FROM SB2010
 WHERE B2_SALPEDI > 0
 ORDER BY B2_COD;

SELECT SUM(B2_RESERVA) AS B2_RESERVA
  FROM SB2010
 WHERE D_E_L_E_T_ = ' ';

SELECT * FROM AFC010 WHERE AFC_XPROD = 'CELROB001212B';  

SELECT D_E_L_E_T_, * FROM SC5010 WHERE C5_XPROJET = 'PMS001212A';

SELECT SC6.C6_FILIAL,SC6.C6_NUM,SC6.C6_ITEM,SC6.C6_PRODUTO,SC6.C6_BLQ,SC6.C6_NUMOS,SC6.C6_QTDEMP,SC6.C6_NUMOSFA,SC6.C6_QTDENT,SC6.C6_RESERVA,SC6.C6_TES,SC6.C6_NUMLOTE,SC6.C6_CLI,SC6.C6_LOCAL,SC6.C6_LOTECTL,SC6.C6_LOJA,SC6.C6_QTDVEN,SC6.C6_OP,SC6.C6_NUMSERI,SC6.C6_LOCALIZ,SC6.C6_QTDRESE,SC6.C6_DTVALID,SC6.C6_QTDLIB,SC6.C6_PRCVEN,SC6.C6_PRUNIT,SC6.C6_VALDESC,SC6.C6_VALOR,SC6.C6_UNSVEN,SC6.C6_ENTREG,SC6.C6_DATFAT,SC6.C6_DESCONT,SC6.C6_QTDLIB2,SC6.R_E_C_N_O_ SC6RECNO,SB1.B1_FILIAL,SC6.C6_QTDEMP2,SC6.C6_QTDENT2 FROM SC6010 SC6 , SB1010 SB1 WHERE SC6.C6_FILIAL='01' AND SC6.C6_BLQ <> 'S ' AND SC6.C6_BLQ <> 'R ' AND (SC6.C6_QTDVEN > SC6.C6_QTDENT OR (SC6.C6_QTDVEN <= SC6.C6_QTDENT AND SC6.C6_ENTREG>='20120420')) AND SC6.D_E_L_E_T_=' ' AND SB1.B1_FILIAL='01' AND SB1.B1_COD=SC6.C6_PRODUTO AND SB1.D_E_L_E_T_=' ' 
 ORDER BY C6_FILIAL,C6_NUM,C6_ITEM,C6_PRODUTO 
 
SELECT * FROM SC9010 WHERE C9_NFISCAL = '' AND C9_BLCRED = '' AND C9_BLEST = ''; 

SELECT C6_PRODUTO, SUM(C6_QTDEMP) AS C6_QTDEMP
  FROM SC6010 
 WHERE D_E_L_E_T_ = ' ' AND C6_QTDEMP > 0 AND C6_NOTA = ''
 GROUP BY C6_PRODUTO
 ORDER BY C6_PRODUTO;

SELECT B2_COD, B2_RESERVA FROM SB2010
 WHERE D_E_L_E_T_ = ' ' AND B2_RESERVA > 0
 ORDER BY B2_COD;
 
SELECT C6_NUM, C6_QTDEMP, * FROM SC6010 
 WHERE D_E_L_E_T_ = ' ' AND C6_QTDEMP > 0 AND C6_NOTA = '' AND C6_PRODUTO = 'MOENG';

-- Apresenta Movimento com Lote
SELECT * FROM SD1010 WHERE D_E_L_E_T_ = ' ' AND D1_LOTECTL <> ''; 
SELECT D2_LOTECTL, * FROM SD2010 WHERE D_E_L_E_T_ = ' ' AND D2_LOTECTL <> ''; 
SELECT * FROM SD3010 WHERE D_E_L_E_T_ = ' ' AND D3_LOTECTL <> ''; 
SELECT * FROM SD4010 WHERE D_E_L_E_T_ = ' ' AND D4_LOTECTL <> ''; 

-- 25.05.2012          
SELECT * FROM SB8010 WHERE B8_PRODUTO = '138068-1';
SELECT * FROM SD5010 WHERE D5_PRODUTO = '138068-1';

SELECT D2_LOTECTL, * FROM SD2010 WHERE D_E_L_E_T_ = ' ' AND D2_COD = '138068-1' AND D2_DOC = '000005178';

SELECT D2_LOTECTL, * FROM SD2010 WHERE D2_LOTECTL <> '';

SELECT D1_LOTECTL, D1_NFORI, D1_TIPO, D1_FORNECE, D1_COD, * 
  FROM SD1010 
 WHERE D1_LOTECTL <> '' ORDER BY R_E_C_N_O_;

SELECT * FROM SB8010 WHERE B8_PRODUTO LIKE '%CEL%';

SELECT * FROM SD1010 WHERE D1_COD = 'CELNAC007111A';
SELECT D2_EMISSAO, * FROM SD2010 WHERE D2_COD = 'CELNAC007111A';
SELECT D3_EMISSAO, * FROM SD3010 WHERE D3_COD = 'CELNAC007111A';

SELECT * FROM SB8010 WHERE B8_PRODUTO = '138068-1';
SELECT B2_RESERVA, * FROM SB2010 WHERE B2_COD = '138068-1';

SELECT * FROM SD5010 WHERE D5_PRODUTO = '138068-1';