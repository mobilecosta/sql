SELECT QRY.*, SB6.*
  FROM SB6010 SB6
  JOIN 
(
SELECT 'E' AS TIPO, SD1.D1_TES, SF4.F4_TEXTO, SF4.F4_PODER3, SF4.F4_TESDV, 
       SD1.D1_DOC, SD1.D1_SERIE, SD1.D1_FORNECE, SD1.D1_LOJA, SD1.D1_DTDIGIT, SD1.D1_EMISSAO, SD1.D1_IDENTB6, SD1.D1_QUANT,
       SD1.D1_NFORI, SD1.D1_SERIORI, SD1.D1_ITEMORI 
  FROM SD1010 SD1
  LEFT JOIN SF4010 SF4 ON SF4.F4_FILIAL = SD1.D1_FILIAL AND SF4.F4_CODIGO = SD1.D1_TES
--  WHERE SD1.D_E_L_E_T_ = ' ' AND SD1.D1_TES IN ('227', '462', '742', '747')
WHERE SD1.D_E_L_E_T_ = ' ' AND SD1.D1_FORNECE = '000004' AND SD1.D1_COD = 'Z00.1285-10' 
-- WHERE SD1.D_E_L_E_T_ = ' ' AND SD1.D1_FORNECE = '005301' AND SD1.D1_COD = '150205-1' 
-- WHERE SD1.D_E_L_E_T_ = ' ' AND SD1.D1_FORNECE = '005662' AND SD1.D1_COD = '155707-8'
 UNION
SELECT 'S' AS TIPO, SD2.D2_TES, SF4.F4_TEXTO, SF4.F4_PODER3, SF4.F4_TESDV, 
       SD2.D2_DOC, SD2.D2_SERIE, SD2.D2_CLIENTE, SD2.D2_LOJA, SD2.D2_EMISSAO, SD2.D2_EMISSAO, SD2.D2_IDENTB6, SD2.D2_QUANT,
       SD2.D2_NFORI, SD2.D2_SERIORI, SD2.D2_ITEMORI 
  FROM SD2010 SD2
  LEFT JOIN SF4010 SF4 ON SF4.F4_FILIAL = SD2.D2_FILIAL AND SF4.F4_CODIGO = SD2.D2_TES
-- WHERE SD2.D_E_L_E_T_ = ' ' AND SD2.D2_TES IN ('227', '462', '742', '747')
 WHERE SD2.D_E_L_E_T_ = ' ' AND SD2.D2_CLIENTE = '000004' AND SD2.D2_COD = 'Z00.1285-10' 
-- WHERE SD2.D_E_L_E_T_ = ' ' AND SD2.D2_CLIENTE = '005301' AND SD2.D2_COD = '150205-1' 
-- WHERE SD2.D_E_L_E_T_ = ' ' AND SD2.D2_CLIENTE = '005662' AND SD2.D2_COD = '155707-8'
 ORDER BY 12, 10, 7, 6
) QRY ON QRY.D1_IDENTB6 = SB6.B6_IDENT
WHERE SB6.D_E_L_E_T_ = ' ';

SELECT * FROM SB6010 WHERE D_E_L_E_T_ = ' ' AND B6_PRODUTO = 'Z00.1285-10' 
   AND B6_CLIFOR = '000004';

SELECT * FROM SB6010 WHERE D_E_L_E_T_ = ' ' AND B6_PRODUTO = '150205-1' 
   AND B6_CLIFOR = '005301';

SELECT * FROM SB6010 WHERE D_E_L_E_T_ = ' ' AND B6_PRODUTO = '155707-8';
   
-- Entradas
-- 1. Recebimento de mercadoria da MotoMan
SELECT * FROM SF4010 WHERE D_E_L_E_T_ = ' ' AND F4_CODIGO < '500' AND F4_PODER3 = 'D'    
 ORDER BY F4_CODIGO;
 
-- 2. Entrada de Mercadoria de Terceiros
SELECT * FROM SF4010 WHERE D_E_L_E_T_ = ' ' AND F4_CODIGO < '500' AND F4_PODER3 = 'R'    
 ORDER BY F4_CODIGO;
 
-- Saidas
-- 3. Devolução da Mercadoria de Terceiros
SELECT * FROM SF4010 WHERE D_E_L_E_T_ = ' ' AND F4_CODIGO >= '500' AND F4_PODER3 = 'D'    
 ORDER BY F4_CODIGO;
 
-- 4. Envio de mercadoria da MotoMan para Terceiros
SELECT * FROM SF4010 WHERE D_E_L_E_T_ = ' ' AND F4_CODIGO >= '500' AND F4_PODER3 = 'R'    
 ORDER BY F4_CODIGO;
  

UPDATE SD1010 
   SET D1_TES = CASE WHEN D1_TES = '186' THEN '207' ELSE
                CASE WHEN D1_TES = '304' THEN '208' ELSE '209' END END
 WHERE D_E_L_E_T_ = ' ' AND R_E_C_N_O_ IN (                
SELECT SD1.R_E_C_N_O_
  FROM SD1010 SD1
  LEFT JOIN SF4010 SF4 ON SF4.F4_FILIAL = SD1.D1_FILIAL AND SF4.F4_CODIGO = SD1.D1_TES
 WHERE SD1.D_E_L_E_T_ = ' ' AND SD1.D1_NFORI <> '' AND SF4.F4_PODER3 = 'R'
) 

SELECT D1_COD
  FROM SD1010
 WHERE D_E_L_E_T_ = ' ' AND D1_TES IN ('207', '208', '209')
GROUP BY D1_COD
ORDER BY D1_COD 