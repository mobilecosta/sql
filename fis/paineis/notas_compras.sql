DECLARE @I_F1_DTDIGIT VARCHAR(8);
DECLARE @F_F1_DTDIGIT VARCHAR(8);
SET @I_F1_DTDIGIT = '20130101';
SET @F_F1_DTDIGIT = '20131231';

-- Cabecalho da Nota Fiscal
SELECT SF1.F1_DOC, SF1.F1_SERIE, SF1.F1_FORNECE, SF1.F1_LOJA, SA2.A2_NOME, SF1.F1_DTDIGIT, SF1.F1_EMISSAO, SF1.F1_TIPO, SF1.F1_CHVNFE,
       SF1.F1_DTLANC, SF1.F1_PREFIXO, SF1.F1_COND, SE4.E4_DESCRI, SF1.F1_DUPL, SF1.R_E_C_N_O_, SF1.R_E_C_N_O_ AS RECNO 
  FROM SF1990 SF1
  JOIN SA2990 SA2 ON SA2.D_E_L_E_T_ = ' ' AND SA2.A2_FILIAL = '  ' AND SA2.A2_COD = SF1.F1_FORNECE AND SA2.A2_LOJA = SF1.F1_LOJA
  LEFT JOIN SE4990 SE4 ON SE4.D_E_L_E_T_ = ' ' AND SE4.E4_FILIAL = SF1.F1_FILIAL AND SE4.E4_CODIGO = SF1.F1_COND
 WHERE SF1.D_E_L_E_T_ = ' ' 
   AND SF1.F1_FILIAL = '01'
   AND SF1.F1_TIPO IN ('N', 'P', 'I', 'C')
   AND SF1.F1_DTDIGIT BETWEEN @I_F1_DTDIGIT AND @F_F1_DTDIGIT
 UNION 
SELECT SF1.F1_DOC, SF1.F1_SERIE, SF1.F1_FORNECE, SF1.F1_LOJA, SA1.A1_NOME, SF1.F1_DTDIGIT, SF1.F1_EMISSAO, SF1.F1_TIPO, SF1.F1_CHVNFE,
       SF1.F1_DTLANC, SF1.F1_PREFIXO, SF1.F1_COND, SE4.E4_DESCRI, SF1.F1_DUPL, SF1.R_E_C_N_O_, SF1.R_E_C_N_O_ AS RECNO
  FROM SF1990 SF1
  JOIN SA1990 SA1 ON SA1.D_E_L_E_T_ = ' ' AND SA1.A1_FILIAL = '  ' AND SA1.A1_COD = SF1.F1_FORNECE AND SA1.A1_LOJA = SF1.F1_LOJA
  LEFT JOIN SE4990 SE4 ON SE4.D_E_L_E_T_ = ' ' AND SE4.E4_FILIAL = SF1.F1_FILIAL AND SE4.E4_CODIGO = SF1.F1_COND
 WHERE SF1.D_E_L_E_T_ = ' ' 
   AND SF1.F1_FILIAL = '01'
   AND SF1.F1_TIPO IN ('D', 'B')
   AND SF1.F1_DTDIGIT BETWEEN @I_F1_DTDIGIT AND @F_F1_DTDIGIT;

SELECT SF1.F1_DOC, SF1.F1_SERIE, SF1.F1_FORNECE, SF1.F1_LOJA, SF1.F1_DTDIGIT, SF1.F1_EMISSAO, SF1.F1_TIPO, SF1.F1_CHVNFE,
       SF1.F1_DTLANC, SF1.R_E_C_N_O_ 
  FROM <ADVPL>RetSqlName("SF1")</ADVPL> SF1
 WHERE SF1.D_E_L_E_T_ = ' ' 
   AND SF1.F1_FILIAL = '<ADVPL>xFilial("SF1")</ADVPL>'
   AND SF1.F1_DTDIGIT BETWEEN @I_F1_DTDIGIT@ AND @F_F1_DTDIGIT@;

-- Itens da Nota Fiscal
-- D1_DOC=F1_DOC;D1_SERIE=F1_SERIE;D1_FORNECE=F1_FORNECE;D1_LOJA=F1_LOJA
DECLARE @I_F1_DTDIGIT VARCHAR(8);
DECLARE @F_F1_DTDIGIT VARCHAR(8);
SET @I_F1_DTDIGIT = '20130101';
SET @F_F1_DTDIGIT = '20131231';

SELECT SD1.D1_DOC, SD1.D1_SERIE, SD1.D1_FORNECE, SD1.D1_LOJA, SD1.D1_COD, SB1.B1_DESC, SD1.D1_LOCAL, SD1.D1_TES, SD1.D1_CF,
       SD1.D1_CONTA, CT1.CT1_DESC01, SD1.D1_CC, CTT.CTT_DESC01, SF4.F4_CTIPI, SD1.D1_BASEIPI, SD1.D1_IPI, SD1.D1_VALIPI,
	   SF4.F4_SITTRIB, SD1.D1_BASEICM, SD1.D1_PICM, SD1.D1_VALICM, SF4.F4_CSTPIS, SD1.D1_BASIMP6 AS BASEPIS, 
	   SD1.D1_ALQIMP6 AS ALIQPIS, SD1.D1_VALIMP6 AS VALPIS, SF4.F4_CSTCOF, SD1.D1_BASIMP5 AS BASECOF, 
	   SD1.D1_ALQIMP5 AS ALIQCOF, SD1.D1_VALIMP5 AS VALCOF
  FROM SD1990 SD1
  JOIN SF1990 SF1 ON SF1.D_E_L_E_T_ = ' ' AND SF1.F1_FILIAL = SD1.D1_FILIAL AND SD1.D1_DOC = SF1.F1_DOC
   AND SD1.D1_SERIE = SF1.F1_SERIE AND SD1.D1_FORNECE = SF1.F1_FORNECE AND SD1.D1_LOJA = SD1.D1_LOJA
   AND SF1.F1_DTDIGIT BETWEEN @I_F1_DTDIGIT AND @F_F1_DTDIGIT
  JOIN SB1990 SB1 ON SB1.D_E_L_E_T_ = ' ' AND SB1.B1_FILIAL = SD1.D1_FILIAL AND SB1.B1_COD = SD1.D1_COD
  LEFT JOIN CT1990 CT1 ON CT1.D_E_L_E_T_ = ' ' AND CT1.CT1_FILIAL = SD1.D1_FILIAL AND CT1.CT1_CONTA = SD1.D1_CONTA
  LEFT JOIN CTT990 CTT ON CTT.D_E_L_E_T_ = ' ' AND CTT.CTT_FILIAL = SD1.D1_FILIAL AND CTT.CTT_CUSTO = SD1.D1_CC
  JOIN SF4990 SF4 ON SF4.D_E_L_E_T_ = ' ' AND SF4.F4_FILIAL = SD1.D1_FILIAL AND SF4.F4_CODIGO = SD1.D1_TES
 WHERE SD1.D_E_L_E_T_ = ' ';

-- Contas a Pagar
-- SE2 x SF1
-- E2_FILIAL=F1_FILIAL;E2_FORNECE=F1_FORNECE;E2_LOJA=F1_LOJA;E2_PREFIXO=F1_PREFIXO;E2_NUM=F1_DUPL;E2_TIPO=MVNOTAFIS

SELECT SE2.E2_FILIAL, SE2.E2_PREFIXO, SE2.E2_NUM, SE2.E2_FORNECE, SE2.E2_LOJA, SE2.E2_TIPO, SE2.E2_PARCELA, SE2.E2_EMISSAO, SE2.E2_VENCTO, 
       SE2.E2_VENCREA, SE2.E2_VALOR
  FROM SE2990 SE2 
  JOIN SF1990 SF1 ON SE2.D_E_L_E_T_ = ' ' AND SF1.F1_FILIAL = SE2.E2_FILIAL AND SF1.F1_FORNECE = SE2.E2_FORNECE 
   AND SF1.F1_LOJA = SE2.E2_LOJA AND SF1.F1_PREFIXO = SE2.E2_PREFIXO AND SF1.F1_DUPL = SE2.E2_NUM 
   AND SF1.F1_DUPL <> ''
 WHERE SE2.D_E_L_E_T_ = ' ' AND SE2.E2_TIPO = 'NF'
  ORDER BY SE2.E2_FORNECE, SE2.E2_LOJA, SE2.E2_PREFIXO, SE2.E2_NUM;
  
-- Contabilização
-- CT2 x SF1
-- RECNO=RECNO
SELECT SF1.R_E_C_N_O_ AS RECNO, CT2_DATA, CT2_LOTE, CT2_SBLOTE, CT2_DOC, CT2_LINHA, CT2_DC, CT2_DEBITO, CT2_CREDIT, CT2_VALOR, CT2_HP, CT2_HIST, CT2_CCC, CT2_CCD
  FROM SF1990 SF2
  JOIN CTK990 CTK ON CTK.D_E_L_E_T_ = ' ' AND CTK.CTK_FILIAL = SF1.F1_FILIAL AND CTK.CTK_TABORI = 'SF1' AND CTK.CTK_RECORI = SF1.R_E_C_N_O_
  JOIN CT2990 CT2 ON CT2.D_E_L_E_T_ = ' ' AND CT2.CT2_FILIAL = SF1.F1_FILIAL AND CT2.R_E_C_N_O_ = CTK.CTK_RECDES
 WHERE SF1.D_E_L_E_T_ = ' ' AND SF1.F1_EMISSAO BETWEEN @I_F1_DTDIGIT AND @F_F1_DTDIGIT;