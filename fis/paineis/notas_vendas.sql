DECLARE @I_F2_EMISSAO VARCHAR(8);
DECLARE @F_F2_EMISSAO VARCHAR(8);
SET @I_F2_EMISSAO = '20130101';
SET @F_F2_EMISSAO = '20131231';

-- Cabecalho da Nota Fiscal
SELECT SF2.F2_DOC, SF2.F2_SERIE, SF2.F2_CLIENTE, SF2.F2_LOJA, SA1.A1_NOME, SF2.F2_EMISSAO, SF2.F2_TIPO, SF2.F2_CHVNFE,
       SF2.F2_DTLANC, SF2.F2_PREFIXO, SF2.F2_COND, SE4.E4_DESCRI, SF2.F2_DUPL, SF2.R_E_C_N_O_, SF2.R_E_C_N_O_ AS RECNO
  FROM SF2990 SF2
  LEFT JOIN SA1990 SA1 ON SA1.D_E_L_E_T_ = ' ' AND SA1.A1_FILIAL = '  ' AND SA1.A1_COD = SF2.F2_CLIENTE AND SA1.A1_LOJA = SF2.F2_LOJA
  LEFT JOIN SE4990 SE4 ON SE4.D_E_L_E_T_ = ' ' AND SE4.E4_FILIAL = SF2.F2_FILIAL AND SE4.E4_CODIGO = SF2.F2_COND
 WHERE SF2.D_E_L_E_T_ = ' '
   AND SF2.F2_FILIAL = '01'
   AND SF2.F2_TIPO IN ('N', 'P', 'I', 'C')
   AND SF2.F2_EMISSAO BETWEEN @I_F2_EMISSAO AND @F_F2_EMISSAO
 UNION
SELECT SF2.F2_DOC, SF2.F2_SERIE, SF2.F2_CLIENTE, SF2.F2_LOJA, SA2.A2_NOME, SF2.F2_EMISSAO, SF2.F2_TIPO, SF2.F2_CHVNFE,
       SF2.F2_DTLANC, SF2.F2_PREFIXO, SF2.F2_COND, SE4.E4_DESCRI, SF2.F2_DUPL, SF2.R_E_C_N_O_, SF1.R_E_C_N_O_ AS RECNO
  FROM SF2990 SF2
  JOIN SA2990 SA2 ON SA2.D_E_L_E_T_ = ' ' AND SA2.A2_FILIAL = '  ' AND SA2.A2_COD = SF2.F2_CLIENTE AND SA2.A2_LOJA = SF2.F2_LOJA
  LEFT JOIN SE4990 SE4 ON SE4.D_E_L_E_T_ = ' ' AND SE4.E4_FILIAL = SF2.F2_FILIAL AND SE4.E4_CODIGO = SF2.F2_COND
 WHERE SF2.D_E_L_E_T_ = ' '
   AND SF2.F2_FILIAL = '01'
   AND SF2.F2_TIPO IN ('D', 'B')
   AND SF2.F2_EMISSAO BETWEEN @I_F2_EMISSAO AND @F_F2_EMISSAO;

SELECT F2_TIPO, * FROM SF2990 WHERE D_E_L_E_T_ = ' '

-- Itens da Nota Fiscal
-- D2_DOC=F2_DOC;D2_SERIE=F2_SERIE;D2_FORNECE=F2_CLIENTE;D2_LOJA=F2_LOJA
DECLARE @I_F2_EMISSAO VARCHAR(8);
DECLARE @F_F2_EMISSAO VARCHAR(8);
SET @I_F2_EMISSAO = '20130101';
SET @F_F2_EMISSAO = '20131231';

SELECT SD2.D2_DOC, SD2.D2_SERIE, SD2.D2_COD, SB1.B1_DESC, SD2.D2_LOCAL, SD2.D2_TES, SD2.D2_CF,
       SD2.D2_CONTA, CT1.CT1_DESC01, SF4.F4_CTIPI, SD2.D2_BASEIPI, SD2.D2_IPI, SD2.D2_VALIPI,
	    SF4.F4_SITTRIB, SD2.D2_BASEICM, SD2.D2_PICM, SD2.D2_VALICM, SF4.F4_CSTPIS, SD2.D2_BASIMP6 AS BASEPIS,
	    SD2.D2_ALQIMP6 AS ALIQPIS, SD2.D2_VALIMP6 AS VALPIS, SF4.F4_CSTCOF, SD2.D2_BASIMP5 AS BASECOF,
	    SD2.D2_ALQIMP5 AS ALIQCOF, SD2.D2_VALIMP5 AS VALCOF
  FROM SD2990 SD2
  JOIN SF2990 SF2 ON SF2.D_E_L_E_T_ = ' ' AND SF2.F2_FILIAL = SD2.D2_FILIAL AND SD2.D2_DOC = SF2.F2_DOC
   AND SD2.D2_SERIE = SF2.F2_SERIE 
   AND SF2.F2_EMISSAO BETWEEN @I_F2_EMISSAO AND @F_F2_EMISSAO
  JOIN SB1990 SB1 ON SB1.D_E_L_E_T_ = ' ' AND SB1.B1_FILIAL = SD2.D2_FILIAL AND SB1.B1_COD = SD2.D2_COD
  LEFT JOIN CT1990 CT1 ON CT1.D_E_L_E_T_ = ' ' AND CT1.CT1_FILIAL = SD2.D2_FILIAL AND CT1.CT1_CONTA = SD2.D2_CONTA
  JOIN SF4990 SF4 ON SF4.D_E_L_E_T_ = ' ' AND SF4.F4_FILIAL = SD2.D2_FILIAL AND SF4.F4_CODIGO = SD2.D2_TES
 WHERE SD2.D_E_L_E_T_ = ' ';

-- Contas a Pagar
-- SE1 x SF2
-- E1_FILIAL=F2_FILIAL;E1_PREFIXO=F2_PREFIXO;E1_NUM=F2_DUPL;E1_TIPO=MVNOTAFIS

SELECT SE1.*
  FROM SE1990 SE1
  JOIN SF2990 SF2 ON SF2.D_E_L_E_T_ = ' ' AND SF2.F2_FILIAL = SE1.E1_FILIAL AND SF2.F2_PREFIXO = SE1.E1_PREFIXO 
   AND SF2.F2_DUPL = SE1.E1_NUM AND SF2.F2_DUPL <> ''
 WHERE SE1.D_E_L_E_T_ = ' ' AND SE1.E1_TIPO = 'NF'
  ORDER BY SE1.E1_PREFIXO, SE1.E1_NUM;
  
-- Contabilização
-- CT2 x SF2
-- RECNO=RECNO
SELECT SF2.R_E_C_N_O_ AS RECNO, CT2_DATA, CT2_LOTE, CT2_SBLOTE, CT2_DOC, CT2_LINHA, CT2_DC, CT2_DEBITO, CT2_CREDIT, CT2_VALOR, CT2_HP, CT2_HIST, CT2_CCC, CT2_CCD
  FROM SF2990 SF2
  JOIN CTK990 CTK ON CTK.D_E_L_E_T_ = ' ' AND CTK.CTK_FILIAL = SF2.F2_FILIAL AND CTK.CTK_TABORI = 'SF2' AND CTK.CTK_RECORI = SF2.R_E_C_N_O_
  JOIN CT2990 CT2 ON CT2.D_E_L_E_T_ = ' ' AND CT2.CT2_FILIAL = SF2.F2_FILIAL AND CT2.R_E_C_N_O_ = CTK.CTK_RECDES
 WHERE SF2.D_E_L_E_T_ = ' ' AND SF2.F2_EMISSAO BETWEEN @I_F2_EMISSAO AND @F_F2_EMISSAO;