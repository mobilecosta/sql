-- Registro F600 por Emissão
SELECT SE1.E1_PREFIXO PREFIXO, SE1.E1_NUM NUMERO, SE1.E1_PARCELA PARCELA, SE1.E1_TIPO TIPO, SE1.E1_CLIENTE CLIENTE, SE1.E1_LOJA LOJA,
       SE1.E1_EMISSAO DATA, SE1.E1_BASEPIS BASE, SE1.E1_PIS PIS, SE1.E1_COFINS COFINS, SA1.A1_CGC CNPJ, SA1.A1_RECPIS RECPIS, SA1.A1_RECCOFI RECCOFI,
       SED.ED_INDRET INDRET, SED.ED_INDCMLT INDCMLT, SED.ED_COND COND, SE1.R_E_C_N_O_ RECNO
  FROM SE1010 SE1, SA1010 SA1, SED010 SED
 WHERE SE1.E1_FILIAL= '01' AND (SE1.E1_PIS > 0 OR SE1.E1_COFINS > 0) AND (SE1.E1_EMISSAO BETWEEN '20130501' AND '20130531')
   AND SA1.A1_PESSOA = 'J' AND SED.ED_CODIGO = SE1.E1_NATUREZ AND SE1.E1_LOJA = SA1.A1_LOJA AND SE1.E1_CLIENTE = SA1.A1_COD
   AND SE1.E1_TIPO NOT IN ('ND ','IR-','IN-','IS-','PI-','CF-','CS-','FU-','FE-')
   AND SE1.E1_TIPO NOT IN ('NCC') AND SE1.E1_TIPO NOT IN ('PR')
   AND NOT EXISTS ( SELECT * FROM SFQ010 SFQ WHERE  SFQ.FQ_ENTDES = 'SE1' AND SE1.E1_PREFIXO = SFQ.FQ_PREFDES AND SE1.E1_NUM = SFQ.FQ_NUMDES
                       AND SE1.E1_PARCELA = SFQ.FQ_PARCDES AND SE1.E1_TIPO = SFQ.FQ_TIPODES AND SE1.E1_CLIENTE = SFQ.FQ_CFDES AND SE1.E1_LOJA = SFQ.FQ_LOJADES )
   AND SE1.D_E_L_E_T_ = '' AND SA1.D_E_L_E_T_ = '' AND SED.D_E_L_E_T_ = ''

-- Registro F600 por Baixa
SELECT SE5.E5_FILIAL FILIAL , SE5.E5_PREFIXO PREFIXO, SE5.E5_NUMERO NUMERO, SE5.E5_PARCELA PARCELA, SE5.E5_TIPO TIPO,
       SE5.E5_CLIFOR CLIENTE, SE5.E5_LOJA LOJA, SE5.E5_TIPODOC TIPODOC, SE5.E5_DATA DATA, SE5.E5_FILORIG FILORIG,
       SE5.E5_VALOR VALORE5 , SE5.E5_NATUREZ NATUREZ, SE5.E5_MOTBX MOTBX, SE5.R_E_C_N_O_ RECNO,
       SE1.E1_PIS PIS, SE1.E1_COFINS COFINS, SE1.E1_CSLL CSLL, SE1.E1_SALDO SALDO, SE1.E1_VALOR VALORE1, SE1.E1_BASEPIS BASEPIS,
       SE1.E1_IRRF VRIR, SE1.E1_INSS VRINSS, SE1.E1_ISS VRISS, SE1.E1_MOEDA TPMOEDA, SE1.E1_VLCRUZ VLCRUZ, SE1.E1_ORIGEM ORIGEM
  FROM SE5010 SE5, SE1010 SE1
 WHERE SE5.E5_FILIAL = '01' AND SE1.E1_FILIAL = '01' AND SE5.E5_PREFIXO = SE1.E1_PREFIXO
   AND SE5.E5_NUMERO = SE1.E1_NUM AND SE5.E5_PARCELA = SE1.E1_PARCELA AND SE5.E5_TIPO = SE1.E1_TIPO AND SE5.E5_CLIFOR = SE1.E1_CLIENTE
   AND SE5.E5_LOJA = SE1.E1_LOJA AND ( ( SE1.E1_PIS > 0 AND SE1.E1_SABTPIS = 0 ) OR ( SE1.E1_COFINS > 0 AND SE1.E1_SABTCOF = 0 ) )
   AND SE5.E5_RECPAG = 'R' AND SE5.E5_SITUACA <> 'C' AND SE5.E5_DATA BETWEEN '20130501' AND '20130531' AND SE5.E5_MOTBX NOT IN ('FAT','LIQ');

-- Titulos com retenção
SELECT E1_NATUREZ, E1_PIS, E1_COFINS, E1_EMISSAO, * FROM SE1010
 WHERE D_E_L_E_T_ = ' ' AND E1_PIS + E1_COFINS > 0
 ORDER BY E1_EMISSAO;

-- Preenche com 03
UPDATE SED010
   SET ED_INDRET = '03'
 WHERE ED_CODIGO IN (
SELECT E1_NATUREZ FROM SE1010
 WHERE D_E_L_E_T_ = ' ' AND E1_PIS + E1_COFINS > 0
 GROUP BY E1_NATUREZ
);

SELECT * FROM SA1010 WHERE A1_CGC = '59298091000136';

SELECT E1_PIS, E1_COFINS, * FROM SE1010 WHERE E1_CLIENTE = '003977' AND E1_EMISSAO >= '20120101' ORDER BY E1_EMISSAO;

SELECT E1_BASEPIS, * FROM SE1010 WHERE E1_CLIENTE = '003977' AND E1_EMISSAO >= '20120101' ORDER BY E1_EMISSAO;

SELECT * FROM SFQ010

-- Base de Calculo
SELECT E1_EMISSAO, E1_CLIENTE, E1_NATUREZ, A1_CGC, E1_NOMCLI, MIN(A1_RECPIS) AS A1_RECPIS, MIN(A1_RECCOFI) AS A1_RECCOFI,
       SUM(E1_PIS) E1_PIS, SUM(E1_COFINS) E1_COFINS
  FROM SE1010
  JOIN SA1010 ON SA1010.A1_FILIAL = '  ' AND SA1010.A1_COD = SE1010.E1_CLIENTE
   AND SA1010.A1_LOJA = SE1010.E1_LOJA AND SA1010.D_E_L_E_T_ = ' '
 WHERE SE1010.D_E_L_E_T_ = ' ' AND E1_PIS > 0
 GROUP BY E1_EMISSAO, E1_CLIENTE, E1_NATUREZ, A1_CGC, E1_NOMCLI
 ORDER BY E1_EMISSAO, E1_CLIENTE, E1_NATUREZ, A1_CGC, E1_NOMCLI;