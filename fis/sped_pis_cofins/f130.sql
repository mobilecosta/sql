-- 1 = Z e 2 = W
update SN1010 set N1_CALCPIS = case when N1_CALCPIS = '1' then 'Z' else 'W' end;

-- Volta
update SN1010 set N1_CALCPIS = case when N1_CALCPIS = 'Z' then '1' else '2' end;

select N1_CALCPIS from SN1010
group by N1_CALCPIS

SELECT * FROM SN4010;

SELECT N1_FILIAL,N1_CBASE,N1_ITEM,N1_CALCPIS,N3_CCONTAB,N3_CCUSTO,N3_CDEPREC,N1_DETPATR,N1_UTIPATR,N1_NFISCAL,N1_NSERIE,N1_FORNEC,N1_LOJA,N3_TIPO,N3_SEQ,N3_SEQREAV,N3_AQUISIC,N3_DINDEPR,N3_VORIG1,N1_QUANTD,N1_ITEM,N3_DLANCTO,N1_DESCRIC,SD1.R_E_C_N_O_ SD1RECNO,N1_MESCPIS,N1_VLAQUIS 
  FROM SN1010 SN1 , SN3010 SN3 , SD1010 SD1 WHERE N1_FILIAL='01' AND N1_CALCPIS IN ('1','S','3') AND N1_CBASE >= '0000000' AND N1_CBASE <= 'ZZZZZZZZZ' AND N1_AQUISIC <= '20111231' AND N1_NFISCAL != ' ' AND N1_NSERIE != ' ' AND N1_FORNEC != ' ' AND N1_LOJA != ' ' AND SN1.D_E_L_E_T_=' ' AND N3_FILIAL= N1_FILIAL AND N3_CBASE=N1_CBASE AND N3_ITEM=N1_ITEM AND N3_TIPO = '01' AND (N3_DTBAIXA > '20111231' OR N3_DTBAIXA = ' ') AND (N1_BAIXA > '20111231' OR N1_BAIXA = ' ') AND N3_SEQ = (SELECT MAX(N4_SEQ) N4_SEQ FROM SN4010 SN4 WHERE N4_FILIAL = SN3.N3_FILIAL AND N4_CBASE = SN3.N3_CBASE AND N4_ITEM = SN3.N3_ITEM AND N4_TIPO = SN3.N3_TIPO AND N4_SEQREAV = SN3.N3_SEQREAV AND N4_OCORR = '05' AND N4_DATA <= '20111231' AND SN4.D_E_L_E_T_ = ' ' )  AND SN3.D_E_L_E_T_=' ' AND D1_FILIAL='01' AND D1_DOC = N1_NFISCAL AND D1_SERIE = N1_NSERIE AND ((D1_ITEM = N1_NFITEM AND N1_NFITEM != ' ') OR (N1_CBASE = SUBSTRING(D1_CBASEAF, 1, 10)) ) AND D1_FORNECE = N1_FORNEC AND D1_LOJA = N1_LOJA AND SD1.D_E_L_E_T_=' ' 